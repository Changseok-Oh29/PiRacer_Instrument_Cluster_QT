<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>DES_InstrucmentCluster: PiRacer Instrument Cluster QT</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">DES_InstrucmentCluster
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

</div><!-- top -->
<div><div class="header">
  <div class="headertitle"><div class="title">PiRacer Instrument Cluster QT</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="autotoc_md51"></a> A sophisticated real-time automotive instrument cluster application built with Qt QML for the PiRacer platform. This project provides a full-featured dashboard display with CAN bus integration, DBus communication, real-time weather data, and advanced signal filtering.</p>
<h1><a class="anchor" id="autotoc_md52"></a>
Features</h1>
<h2><a class="anchor" id="autotoc_md53"></a>
🚗 Core Dashboard Functionality</h2>
<ul>
<li><b>Real-time Speed Display</b>: Shows vehicle speed in cm/s with smooth animations</li>
<li><b>RPM Monitoring</b>: Engine RPM display with color-coded indicators</li>
<li><b>CAN Bus Integration</b>: Reads real vehicle data from CAN bus interface</li>
<li><b>One Euro Filtering</b>: Advanced signal smoothing for stable speed/RPM readings</li>
<li><b>Turn Signal Indicators</b>: Interactive left/right turn signal controls</li>
</ul>
<h2><a class="anchor" id="autotoc_md54"></a>
🔋 Battery &amp; Power Management</h2>
<ul>
<li><b>Battery Level Display</b>: Visual battery bar with color-coded states (critical, low, medium, normal)</li>
<li><b>Charging Status</b>: Real-time charging current monitoring via DBus</li>
<li><b>Charging Indicator</b>: Visual charging icon when current exceeds threshold (&gt;1000mA)</li>
</ul>
<h2><a class="anchor" id="autotoc_md55"></a>
🌤️ Weather Integration</h2>
<ul>
<li><b>Real-time Weather</b>: Current temperature and weather conditions</li>
<li><b>Location Detection</b>: IP-based geolocation with GPS fallback</li>
<li><b>Weather Icons</b>: Dynamic weather icons based on current conditions</li>
<li><b>Multiple Locations</b>: Click to cycle through different locations</li>
</ul>
<h2><a class="anchor" id="autotoc_md56"></a>
🎮 Input &amp; Control</h2>
<ul>
<li><b>Gamepad Support</b>: ShanWan gamepad integration for PiRacer control</li>
<li><b>Interactive UI</b>: Click-to-cycle weather locations</li>
<li><b>Escape Key</b>: Exit application with ESC key</li>
</ul>
<h2><a class="anchor" id="autotoc_md57"></a>
📡 Communication</h2>
<ul>
<li><b>CAN Bus Support</b>: Linux SocketCAN integration for real vehicle data</li>
<li><b>DBus Interface</b>: Communication with PiRacer services</li>
<li><b>Dual Mode Operation</b>: Switches between real CAN data and simulation mode</li>
</ul>
<h1><a class="anchor" id="autotoc_md58"></a>
Architecture</h1>
<h2><a class="anchor" id="autotoc_md59"></a>
Qt QML Application Structure</h2>
<div class="fragment"><div class="line">├── main.qml              # Application entry point</div>
<div class="line">├── content/</div>
<div class="line">│   ├── App.qml           # Main application window</div>
<div class="line">│   ├── Screen01.qml      # Primary dashboard screen</div>
<div class="line">│   ├── BatteryBar.ui.qml # Battery level indicator</div>
<div class="line">│   ├── DashboardDataCAN.qml   # CAN bus data management</div>
<div class="line">│   ├── DashboardDataDBus.qml  # DBus data management</div>
<div class="line">│   ├── WeatherData.qml   # Weather data integration</div>
<div class="line">│   └── VectorIcon.qml    # Interactive vector icons</div>
<div class="line">├── src/</div>
<div class="line">│   ├── main.cpp          # C++ application entry</div>
<div class="line">│   ├── canreceiver.h/cpp # CAN bus communication</div>
<div class="line">│   └── dbusreceiver.h/cpp# DBus communication</div>
<div class="line">└── imports/              # Custom QML modules</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md60"></a>
Data Flow</h2>
<ol type="1">
<li><b>CAN Bus</b>: <code><a class="el" href="canreceiver_8cpp.html">canreceiver.cpp</a></code> → <code>DashboardDataCAN.qml</code> → <code>Screen01.qml</code></li>
<li><b>DBus</b>: <code><a class="el" href="dbusreceiver_8cpp.html">dbusreceiver.cpp</a></code> → <code>DashboardDataDBus.qml</code> → <code>Screen01.qml</code></li>
<li><b>Weather</b>: <code>WeatherData.qml</code> → <code>Screen01.qml</code></li>
<li><b>Filtering</b>: Raw data → One Euro Filter → Smooth animations</li>
</ol>
<h1><a class="anchor" id="autotoc_md61"></a>
Technology Stack</h1>
<h2><a class="anchor" id="autotoc_md62"></a>
Frontend</h2>
<ul>
<li><b>Qt 6.4+</b>: Modern Qt framework</li>
<li><b>QML</b>: Declarative UI language</li>
<li><b>Qt Quick Controls</b>: UI components</li>
<li><b>Qt Positioning</b>: Location services</li>
</ul>
<h2><a class="anchor" id="autotoc_md63"></a>
Backend</h2>
<ul>
<li><b>C++</b>: Core application logic</li>
<li><b>Linux SocketCAN</b>: CAN bus communication</li>
<li><b>Qt DBus</b>: Inter-process communication</li>
<li><b>Python</b>: PiRacer gamepad control</li>
</ul>
<h2><a class="anchor" id="autotoc_md64"></a>
Hardware Integration</h2>
<ul>
<li><b>CAN Interface</b>: <code>can10</code> interface for vehicle data</li>
<li><b>ShanWan Gamepad</b>: Vehicle control input</li>
<li><b>PiRacer Platform</b>: Standard or Pro variants</li>
</ul>
<h1><a class="anchor" id="autotoc_md65"></a>
Signal Processing</h1>
<h2><a class="anchor" id="autotoc_md66"></a>
One Euro Filter</h2>
<p>The application implements a sophisticated One Euro Filter for signal smoothing:</p>
<ul>
<li><b>Adaptive Filtering</b>: Adjusts smoothing based on signal velocity</li>
<li><b>Configurable Parameters</b>:<ul>
<li><code>minCutoff</code>: 1.0 Hz (baseline smoothing)</li>
<li><code>beta</code>: 0.1 (adaptation sensitivity)</li>
<li><code>derivateCutoff</code>: 1.0 Hz (derivative smoothing)</li>
</ul>
</li>
<li><b>Dual Channel</b>: Separate filtering for speed and RPM</li>
<li><b>Real-time Processing</b>: 10Hz sampling rate</li>
</ul>
<h2><a class="anchor" id="autotoc_md67"></a>
Data Validation</h2>
<ul>
<li><b>RPM Threshold</b>: Values below 50 RPM treated as zero</li>
<li><b>Connection Monitoring</b>: Real-time CAN/DBus connection status</li>
<li><b>Error Handling</b>: Graceful fallback to simulation mode</li>
</ul>
<h1><a class="anchor" id="autotoc_md68"></a>
User Interface</h1>
<h2><a class="anchor" id="autotoc_md69"></a>
Dashboard Layout</h2>
<ul>
<li><b>Central Speed Display</b>: Large, prominent speed reading</li>
<li><b>RPM Indicator</b>: Side-mounted RPM display with gear icon</li>
<li><b>Battery Bar</b>: Bottom-mounted battery level indicator</li>
<li><b>Weather Widget</b>: Top-right weather and time display</li>
<li><b>Status Indicators</b>: CAN connection and charging status</li>
</ul>
<h2><a class="anchor" id="autotoc_md70"></a>
Visual Design</h2>
<ul>
<li><b>Dark Theme</b>: Automotive-grade dark interface</li>
<li><b>Color Coding</b>:<ul>
<li>Green (#77C000): Normal status, turn signals</li>
<li>Red (#F44336): Critical battery level</li>
<li>Orange (#FF9800): Low battery warning</li>
<li>Yellow (#FFEB3B): Medium battery level</li>
</ul>
</li>
<li><b>Smooth Animations</b>: 300-400ms transitions</li>
<li><b>Responsive Layout</b>: Scales for different screen sizes</li>
</ul>
<h2><a class="anchor" id="autotoc_md71"></a>
Interactive Elements</h2>
<ul>
<li><b>Turn Signals</b>: Click left/right arrows for turn indicators</li>
<li><b>Weather Cycling</b>: Click weather widget to refresh/cycle locations</li>
<li><b>Battery Monitoring</b>: Real-time charging status display</li>
</ul>
<h1><a class="anchor" id="autotoc_md72"></a>
Configuration Files</h1>
<h2><a class="anchor" id="autotoc_md73"></a>
CAN Bus Setup</h2>
<div class="fragment"><div class="line"><span class="comment">// CAN interface configuration</span></div>
<div class="line"><span class="keyword">const</span> QString <span class="keyword">interface </span>= &quot;can10<span class="stringliteral">&quot;;</span></div>
<div class="line"><span class="stringliteral">// Message ID for speed/RPM data</span></div>
<div class="line"><span class="stringliteral">const uint32_t CAN_ID = 0x123;</span></div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md74"></a>
DBus Service</h2>
<div class="fragment"><div class="line"><span class="comment">// DBus service configuration</span></div>
<div class="line">Service: <span class="stringliteral">&quot;org.team7.IC&quot;</span></div>
<div class="line">Path: <span class="stringliteral">&quot;/CarInformation&quot;</span></div>
<div class="line">Interface: <span class="stringliteral">&quot;org.team7.IC.Interface&quot;</span></div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md75"></a>
Weather API</h2>
<div class="fragment"><div class="line">// Open-Meteo API configuration</div>
<div class="line">Base URL: &quot;http://api.open-meteo.com/v1/forecast&quot;</div>
<div class="line">Parameters: temperature_2m, weather_code, is_day</div>
<div class="line">Location: IP-based geolocation with GPS fallback</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md76"></a>
Data Formats</h1>
<h2><a class="anchor" id="autotoc_md77"></a>
CAN Message Format</h2>
<div class="fragment"><div class="line">ID: 0x123 (8 bytes)</div>
<div class="line">[0-1]: Speed integer (big-endian)</div>
<div class="line">[2]:   Speed fraction (0-99)</div>
<div class="line">[3-4]: RPM integer (big-endian)  </div>
<div class="line">[5]:   RPM fraction (0-99)</div>
<div class="line">[6-7]: Reserved</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md78"></a>
DBus Message Format</h2>
<div class="fragment"><div class="line">{</div>
<div class="line">  &quot;battery_capacity&quot;: 85.5,</div>
<div class="line">  &quot;charging_current&quot;: 1250.0</div>
<div class="line">}</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md79"></a>
Development Features</h1>
<h2><a class="anchor" id="autotoc_md80"></a>
Debug Output</h2>
<ul>
<li><b>Timestamped Logging</b>: All operations include precise timestamps</li>
<li><b>Filter State Monitoring</b>: Real-time filter coefficient display</li>
<li><b>Connection Status</b>: Detailed CAN/DBus connection logging</li>
<li><b>Performance Metrics</b>: Signal processing timing information</li>
</ul>
<h2><a class="anchor" id="autotoc_md81"></a>
Testing Support</h2>
<ul>
<li><b>Simulation Mode</b>: Works without physical hardware</li>
<li><b>Test Scripts</b>: CAN data simulation (<code>test_can_data.sh</code>)</li>
<li><b>DBus Testing</b>: Battery/charging simulation scripts</li>
<li><b>Mock Data</b>: Realistic simulated vehicle parameters</li>
</ul>
<h2><a class="anchor" id="autotoc_md82"></a>
Error Handling</h2>
<ul>
<li><b>Graceful Degradation</b>: Falls back to simulation when hardware unavailable</li>
<li><b>Connection Recovery</b>: Automatic reconnection attempts</li>
<li><b>Input Validation</b>: Robust data parsing and validation</li>
<li><b>Resource Management</b>: Proper cleanup of system resources</li>
</ul>
<h1><a class="anchor" id="autotoc_md83"></a>
Performance Characteristics</h1>
<h2><a class="anchor" id="autotoc_md84"></a>
Real-time Requirements</h2>
<ul>
<li><b>Update Rate</b>: 10Hz CAN data sampling</li>
<li><b>Filter Latency</b>: &lt;100ms signal delay</li>
<li><b>UI Refresh</b>: 60 FPS smooth animations</li>
<li><b>Memory Usage</b>: Optimized for embedded systems</li>
</ul>
<h2><a class="anchor" id="autotoc_md85"></a>
System Requirements</h2>
<ul>
<li><b>Qt Version</b>: 6.4 or higher</li>
<li><b>Platform</b>: Linux (Raspberry Pi optimized)</li>
<li><b>CAN Interface</b>: SocketCAN compatible</li>
<li><b>Python</b>: 3.x for gamepad support</li>
<li><b>Memory</b>: 512MB RAM minimum</li>
<li><b>Storage</b>: 100MB application size</li>
</ul>
<h1><a class="anchor" id="autotoc_md86"></a>
Future Enhancements</h1>
<h2><a class="anchor" id="autotoc_md87"></a>
Planned Features</h2>
<ul>
<li><b>GPS Navigation</b>: Route display and turn-by-turn directions</li>
<li><b>Multiple Screens</b>: Additional dashboard views</li>
<li><b>Data Logging</b>: Historical driving data storage</li>
<li><b>Customization</b>: User-configurable layouts and themes</li>
<li><b>Voice Integration</b>: Audio feedback and commands</li>
<li><b>Mobile App</b>: Companion smartphone application</li>
</ul>
<h2><a class="anchor" id="autotoc_md88"></a>
Hardware Expansion</h2>
<ul>
<li><b>Additional Sensors</b>: Temperature, pressure monitoring</li>
<li><b>Camera Integration</b>: Rear-view camera display</li>
<li><b>Audio System</b>: Music and radio integration</li>
<li><b>Wireless Connectivity</b>: WiFi and Bluetooth support</li>
</ul>
<h1><a class="anchor" id="autotoc_md89"></a>
License</h1>
<p>This project is licensed under the Qt Commercial License or GPL-3.0. See individual file headers for specific licensing information.</p>
<h1><a class="anchor" id="autotoc_md90"></a>
Credits</h1>
<p>Developed for the PiRacer platform using Qt Design Studio and Qt Creator. Weather data provided by Open-Meteo API. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8
</small></address>
</body>
</html>
