<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
  <head>
    <meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=11" />
    <meta name="generator" content="Doxygen 1.9.8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>DES_InstrucmentCluster: API Documentation</title>
    <link href="tabs.css" rel="stylesheet" type="text/css" />
    <script type="text/javascript" src="jquery.js"></script>
    <script type="text/javascript" src="dynsections.js"></script>
    <link href="search/search.css" rel="stylesheet" type="text/css" />
    <script type="text/javascript" src="search/searchdata.js"></script>
    <script type="text/javascript" src="search/search.js"></script>
    <link href="doxygen.css" rel="stylesheet" type="text/css" />
  </head>
  <body>
    <div id="top">
      <!-- do not remove this div, it is closed by doxygen! -->
      <div id="titlearea">
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr id="projectrow">
              <td id="projectalign">
                <div id="projectname">DES_InstrucmentCluster</div>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
      <!-- end header part -->
      <!-- Generated by Doxygen 1.9.8 -->
      <script type="text/javascript">
        /* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
        var searchBox = new SearchBox("searchBox", "search/", ".html");
        /* @license-end */
      </script>
      <script type="text/javascript" src="menudata.js"></script>
      <script type="text/javascript" src="menu.js"></script>
      <script type="text/javascript">
        /* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
        $(function () {
          initMenu("", true, false, "search.php", "Search");
          $(document).ready(function () {
            init_search();
          });
        });
        /* @license-end */
      </script>
      <div id="main-nav"></div>
      <!-- window showing the filter options -->
      <div
        id="MSearchSelectWindow"
        onmouseover="return searchBox.OnSearchSelectShow()"
        onmouseout="return searchBox.OnSearchSelectHide()"
        onkeydown="return searchBox.OnSearchSelectKey(event)"
      ></div>

      <!-- iframe showing the search results (closed by default) -->
      <div id="MSearchResultsWindow">
        <div id="MSearchResults">
          <div class="SRPage">
            <div id="SRIndex">
              <div id="SRResults"></div>
              <div class="SRStatus" id="Loading">Loading...</div>
              <div class="SRStatus" id="Searching">Searching...</div>
              <div class="SRStatus" id="NoMatches">No Matches</div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <!-- top -->
    <div>
      <div class="header">
        <div class="headertitle">
          <div class="title">API Documentation</div>
        </div>
      </div>
      <!--header-->
      <div class="contents">
        <div class="textblock">
          <p><a class="anchor" id="autotoc_md0"></a></p>
          <h1><a class="anchor" id="autotoc_md1"></a> C++ Classes</h1>
          <h2><a class="anchor" id="autotoc_md2"></a> CanReceiver Class</h2>
          <p>
            <b>File</b>:
            <code
              ><a class="el" href="canreceiver_8h.html"
                >src/canreceiver.h</a
              ></code
            >
            /
            <code
              ><a class="el" href="canreceiver_8cpp.html"
                >src/canreceiver.cpp</a
              ></code
            >
          </p>
          <p>
            <b>Purpose</b>: Handles Linux SocketCAN communication for real-time
            vehicle data reception.
          </p>
          <h3><a class="anchor" id="autotoc_md3"></a> Properties</h3>
          <ul>
            <li>
              <code>float speed</code> - Current vehicle speed in cm/s
              (read-only)
            </li>
            <li>
              <code>float rpm</code> - Current engine RPM (read-only) <br />
            </li>
            <li>
              <code>bool connected</code> - CAN bus connection status
              (read-only)
            </li>
          </ul>
          <h3><a class="anchor" id="autotoc_md4"></a> Public Methods</h3>
          <div class="fragment">
            <div class="line">
              <span class="keywordtype">void</span> connectToCan(<span
                class="keyword"
                >const</span
              >
              QString &amp;interface =
              <span class="stringliteral">&quot;can10&quot;</span>)
            </div>
            <div class="line">void disconnectFromCan()</div>
            <div class="line">
              <span class="keywordtype">void</span> startListening()
            </div>
            <div class="line">
              <span class="keywordtype">void</span> stopListening()
            </div>
          </div>
          <!-- fragment -->
          <h3><a class="anchor" id="autotoc_md5"></a> Signals</h3>
          <div class="fragment">
            <div class="line">
              <span class="keywordtype">void</span> speedChanged()
              <span class="comment">// Emitted when speed value updates</span>
            </div>
            <div class="line">
              void rpmChanged()
              <span class="comment">// Emitted when RPM value updates </span>
            </div>
            <div class="line">
              <span class="keywordtype">void</span> connectedChanged()
              <span class="comment"
                >// Emitted when connection status changes</span
              >
            </div>
            <div class="line">
              <span class="keywordtype">void</span> dataReceived(<span
                class="keywordtype"
                >float</span
              >
              speed, <span class="keywordtype">float</span> rpm)
              <span class="comment">// Raw data reception</span>
            </div>
            <div class="line">
              <span class="keywordtype">void</span> errorOccurred(const QString
              &amp;error) <span class="comment">// Error notifications</span>
            </div>
          </div>
          <!-- fragment -->
          <h3><a class="anchor" id="autotoc_md6"></a> CAN Message Format</h3>
          <ul>
            <li><b>Message ID</b>: 0x123</li>
            <li><b>Data Length</b>: 8 bytes</li>
            <li>
              <b>Format</b>: [speed_high, speed_low, speed_frac, rpm_high,
              rpm_low, rpm_frac, reserved, reserved]
            </li>
          </ul>
          <hr />
          <h2><a class="anchor" id="autotoc_md8"></a> DBusReceiver Class</h2>
          <p>
            <b>File</b>:
            <code
              ><a class="el" href="dbusreceiver_8h.html"
                >src/dbusreceiver.h</a
              ></code
            >
            /
            <code
              ><a class="el" href="dbusreceiver_8cpp.html"
                >src/dbusreceiver.cpp</a
              ></code
            >
          </p>
          <p>
            <b>Purpose</b>: Communicates with PiRacer system services via DBus
            for battery and charging data.
          </p>
          <h3><a class="anchor" id="autotoc_md9"></a> Properties</h3>
          <ul>
            <li>
              <code>double battery</code> - Battery level percentage (0-100)
            </li>
            <li>
              <code>double chargingCurrent</code> - Charging current in
              milliamps
            </li>
          </ul>
          <h3><a class="anchor" id="autotoc_md10"></a> DBus Configuration</h3>
          <ul>
            <li><b>Service</b>: org.team7.IC</li>
            <li><b>Path</b>: /CarInformation</li>
            <li><b>Interface</b>: org.team7.IC.Interface</li>
            <li><b>Signal</b>: DataReceived(QString dataJson)</li>
          </ul>
          <h3><a class="anchor" id="autotoc_md11"></a> JSON Data Format</h3>
          <div class="fragment">
            <div class="line">{</div>
            <div class="line">&quot;battery_capacity&quot;: 85.5,</div>
            <div class="line">&quot;charging_current&quot;: 1250.0</div>
            <div class="line">}</div>
          </div>
          <!-- fragment -->
          <h3><a class="anchor" id="autotoc_md12"></a> Signals</h3>
          <div class="fragment">
            <div class="line">
              <span class="keywordtype">void</span> batteryChanged()
              <span class="comment">// Battery level updated</span>
            </div>
            <div class="line">
              void chargingCurrentChanged()
              <span class="comment">// Charging current updated</span>
            </div>
          </div>
          <!-- fragment -->
          <hr />
          <h1><a class="anchor" id="autotoc_md14"></a> QML Components</h1>
          <h2><a class="anchor" id="autotoc_md15"></a> DashboardDataCAN</h2>
          <p><b>File</b>: <code>content/DashboardDataCAN.qml</code></p>
          <p>
            <b>Purpose</b>: QML wrapper for CAN bus data with connection
            management.
          </p>
          <h3><a class="anchor" id="autotoc_md16"></a> Properties</h3>
          <div class="fragment">
            <div class="line">
              <span class="keyword">property</span> real currentSpeed: 0.0
              <span class="comment">// Current vehicle speed</span>
            </div>
            <div class="line">
              <span class="keyword">property</span> real currentRpm: 0.0
              <span class="comment">// Current engine RPM</span>
            </div>
            <div class="line">
              <span class="keyword">property</span>
              <span class="keywordtype">bool</span> canConnected:
              <span class="keyword">false</span>
              <span class="comment">// Connection status</span>
            </div>
            <div class="line">
              <span class="keyword">property</span>
              <span class="keywordtype">string</span> connectionStatus:
              <span class="stringliteral">&quot;&quot;</span>
              <span class="comment">// Human-readable status</span>
            </div>
          </div>
          <!-- fragment -->
          <h3><a class="anchor" id="autotoc_md17"></a> Methods</h3>
          <div class="fragment">
            <div class="line">
              <span class="keyword">function</span> reconnectCan()
              <span class="comment">// Reconnect to CAN interface</span>
            </div>
            <div class="line">
              function disconnectCan()
              <span class="comment">// Disconnect from CAN interface</span>
            </div>
            <div class="line">
              function
              <a
                class="code hl_function"
                href="build-native_2content_2DashboardLogic_8qml.html#abbcf35d73e469b5da279dee8010cd7ce"
                >updateValues</a
              >() <span class="comment">// Refresh property values</span>
            </div>
            <div
              class="ttc"
              id="abuild-native_2content_2DashboardLogic_8qml_html_abbcf35d73e469b5da279dee8010cd7ce"
            >
              <div class="ttname">
                <a
                  href="build-native_2content_2DashboardLogic_8qml.html#abbcf35d73e469b5da279dee8010cd7ce"
                  >updateValues</a
                >
              </div>
              <div class="ttdeci">function updateValues()</div>
              <div class="ttdef"><b>Definition</b> DashboardLogic.qml:31</div>
            </div>
          </div>
          <!-- fragment -->
          <hr />
          <h2><a class="anchor" id="autotoc_md19"></a> DashboardDataDBus</h2>
          <p><b>File</b>: <code>content/DashboardDataDBus.qml</code></p>
          <p><b>Purpose</b>: QML wrapper for DBus battery and charging data.</p>
          <h3><a class="anchor" id="autotoc_md20"></a> Properties</h3>
          <div class="fragment">
            <div class="line">
              <span class="keyword">property</span> real batteryLevel: 0.0
              <span class="comment">// Battery percentage</span>
            </div>
            <div class="line">
              <span class="keyword">property</span> real chargingCurrent: 0.0
              <span class="comment">// Charging current (mA)</span>
            </div>
            <div class="line">
              <span class="keyword">property</span>
              <span class="keywordtype">bool</span> dbusConnected:
              <span class="keyword">false</span>
              <span class="comment">// DBus connection status</span>
            </div>
          </div>
          <!-- fragment -->
          <hr />
          <h2><a class="anchor" id="autotoc_md22"></a> WeatherData</h2>
          <p><b>File</b>: <code>content/WeatherData.qml</code></p>
          <p>
            <b>Purpose</b>: Real-time weather data integration with geolocation.
          </p>
          <h3><a class="anchor" id="autotoc_md23"></a> Properties</h3>
          <div class="fragment">
            <div class="line">
              <span class="keyword">property</span>
              <span class="keywordtype">string</span> currentLocation:
              <span class="stringliteral">&quot;&quot;</span>
              <span class="comment">// Current city/location</span>
            </div>
            <div class="line">
              <span class="keyword">property</span> real currentTemperature: 0.0
              <span class="comment">// Temperature in Celsius</span>
            </div>
            <div class="line">
              <span class="keyword">property</span>
              <span class="keywordtype">int</span> weatherCode: 0
              <span class="comment">// Weather condition code</span>
            </div>
            <div class="line">
              <span class="keyword">property</span>
              <span class="keywordtype">bool</span> isDay:
              <span class="keyword">true</span>
              <span class="comment">// Day/night status</span>
            </div>
            <div class="line">
              <span class="keyword">property</span>
              <span class="keywordtype">string</span> weatherDescription:
              <span class="stringliteral">&quot;&quot;</span>
              <span class="comment">// Human-readable weather</span>
            </div>
            <div class="line">
              <span class="keyword">property</span>
              <span class="keywordtype">string</span> weatherIconUrl:
              <span class="stringliteral">&quot;&quot;</span>
              <span class="comment">// Weather icon URL</span>
            </div>
            <div class="line">
              <span class="keyword">property</span>
              <span class="keywordtype">string</span> currentTime:
              <span class="stringliteral">&quot;&quot;</span>
              <span class="comment">// Formatted current time</span>
            </div>
            <div class="line">
              <span class="keyword">property</span> real latitude: 0.0
              <span class="comment">// GPS latitude</span>
            </div>
            <div class="line">
              <span class="keyword">property</span> real longitude: 0.0
              <span class="comment">// GPS longitude</span>
            </div>
          </div>
          <!-- fragment -->
          <h3><a class="anchor" id="autotoc_md24"></a> Methods</h3>
          <div class="fragment">
            <div class="line">
              <span class="keyword">function</span> enableGeolocation()
              <span class="comment">// Enable GPS positioning</span>
            </div>
            <div class="line">
              function disableGeolocation()
              <span class="comment">// Disable GPS positioning</span>
            </div>
            <div class="line">
              function useIPGeolocation()
              <span class="comment">// Use IP-based location</span>
            </div>
            <div class="line">
              function refreshWeather()
              <span class="comment">// Refresh weather data</span>
            </div>
            <div class="line">
              function refreshLocation()
              <span class="comment">// Cycle through locations</span>
            </div>
            <div class="line">
              function setLocation(lat, lon)
              <span class="comment">// Set manual coordinates</span>
            </div>
          </div>
          <!-- fragment -->
          <h3>
            <a class="anchor" id="autotoc_md25"></a> Weather API Integration
          </h3>
          <ul>
            <li><b>Provider</b>: Open-Meteo API</li>
            <li>
              <b>Endpoint</b>:
              <a href="http://api.open-meteo.com/v1/forecast"
                >http://api.open-meteo.com/v1/forecast</a
              >
            </li>
            <li>
              <b>Update Frequency</b>: On location change or manual refresh
            </li>
            <li><b>Fallback</b>: IP geolocation when GPS unavailable</li>
          </ul>
          <hr />
          <h2><a class="anchor" id="autotoc_md27"></a> BatteryBar</h2>
          <p><b>File</b>: <code>content/BatteryBar.ui.qml</code></p>
          <p>
            <b>Purpose</b>: Visual battery level indicator with color-coded
            states.
          </p>
          <h3><a class="anchor" id="autotoc_md28"></a> Properties</h3>
          <div class="fragment">
            <div class="line">
              <span class="keyword">property</span>
              <span class="keywordtype">int</span> batteryLevel: 100
              <span class="comment">// Battery level (0-100)</span>
            </div>
            <div class="line">
              <span class="keyword">property</span> color batteryColor:
              <span class="stringliteral">&quot;#77C000&quot;</span>
              <span class="comment">// Current battery color</span>
            </div>
            <div class="line">
              <span class="keyword">property</span>
              <span class="keywordtype">bool</span> useRealData:
              <span class="keyword">true</span>
              <span class="comment">// Use real vs demo data</span>
            </div>
          </div>
          <!-- fragment -->
          <h3><a class="anchor" id="autotoc_md29"></a> Color States</h3>
          <ul>
            <li><b>Critical (&lt; 20%)</b>: #F44336 (Red)</li>
            <li><b>Low (20-40%)</b>: #FF9800 (Orange) <br /></li>
            <li><b>Medium (40-70%)</b>: #FFEB3B (Yellow)</li>
            <li><b>Normal (&gt; 70%)</b>: #77C000 (Green)</li>
          </ul>
          <hr />
          <h1><a class="anchor" id="autotoc_md31"></a> Signal Processing</h1>
          <h2>
            <a class="anchor" id="autotoc_md32"></a> One Euro Filter
            Implementation
          </h2>
          <p><b>Location</b>: <code>content/Screen01.qml</code></p>
          <p>
            <b>Purpose</b>: Advanced signal smoothing for stable speed/RPM
            display.
          </p>
          <h3>
            <a class="anchor" id="autotoc_md33"></a> Configuration Parameters
          </h3>
          <div class="fragment">
            <div class="line">
              <span class="keyword">property</span> real minCutoff: 1.0
              <span class="comment">// Minimum cutoff frequency (Hz)</span>
            </div>
            <div class="line">
              <span class="keyword">property</span> real beta: 0.1
              <span class="comment">// Cutoff slope adaptation</span>
            </div>
            <div class="line">
              <span class="keyword">property</span> real derivateCutoff: 1.0
              <span class="comment">// Derivative smoothing cutoff</span>
            </div>
          </div>
          <!-- fragment -->
          <h3><a class="anchor" id="autotoc_md34"></a> Core Functions</h3>
          <div class="fragment">
            <div class="line">
              <span class="keyword">function</span> lowPassFilter(current,
              previous, alpha)
            </div>
            <div class="line">
              <span class="keyword">function</span> calculateAlpha(cutoff, dt)
            </div>
            <div class="line">
              <span class="keyword">function</span> oneEuroFilterSpeed(value,
              timestamp)
            </div>
            <div class="line">
              <span class="keyword">function</span> oneEuroFilterRpm(value,
              timestamp)
            </div>
          </div>
          <!-- fragment -->
          <h3><a class="anchor" id="autotoc_md35"></a> Algorithm Details</h3>
          <ol type="1">
            <li><b>Derivative Calculation</b>: Rate of signal change</li>
            <li>
              <b>Adaptive Cutoff</b>: Frequency adjustment based on signal
              velocity
            </li>
            <li><b>Low-pass Filtering</b>: Smooth signal transitions</li>
            <li>
              <b>Temporal Processing</b>: 10Hz sampling with timestamp tracking
            </li>
          </ol>
          <hr />
          <h1>
            <a class="anchor" id="autotoc_md37"></a> Data Flow Architecture
          </h1>
          <h2><a class="anchor" id="autotoc_md38"></a> CAN Bus Data Flow</h2>
          <div class="fragment">
            <div class="line">
              Physical CAN Bus → SocketCAN → CanReceiver C++ → DashboardDataCAN
              QML → Screen01 QML → One Euro Filter → UI Display
            </div>
          </div>
          <!-- fragment -->
          <h2><a class="anchor" id="autotoc_md39"></a> DBus Data Flow</h2>
          <div class="fragment">
            <div class="line">
              PiRacer Service → DBus → DBusReceiver C++ → DashboardDataDBus QML
              → Screen01 QML → UI Display
            </div>
          </div>
          <!-- fragment -->
          <h2><a class="anchor" id="autotoc_md40"></a> Weather Data Flow</h2>
          <div class="fragment">
            <div class="line">
              IP/GPS Location → Open-Meteo API → WeatherData QML → Screen01 QML
              → UI Display
            </div>
          </div>
          <!-- fragment -->
          <hr />
          <h1><a class="anchor" id="autotoc_md42"></a> Error Handling</h1>
          <h2><a class="anchor" id="autotoc_md43"></a> CAN Bus Errors</h2>
          <ul>
            <li>
              <b>Connection Timeout</b>: Automatic fallback to simulation mode
            </li>
            <li><b>Invalid Data</b>: Data validation and filtering</li>
            <li>
              <b>Interface Errors</b>: Error signals with descriptive messages
            </li>
          </ul>
          <h2><a class="anchor" id="autotoc_md44"></a> DBus Errors</h2>
          <ul>
            <li>
              <b>Service Unavailable</b>: Graceful degradation with default
              values
            </li>
            <li><b>JSON Parse Errors</b>: Robust error handling and logging</li>
            <li><b>Connection Loss</b>: Automatic reconnection attempts</li>
          </ul>
          <h2><a class="anchor" id="autotoc_md45"></a> Weather API Errors</h2>
          <ul>
            <li><b>Network Failures</b>: Fallback to cached data</li>
            <li><b>API Limits</b>: Retry logic with exponential backoff</li>
            <li><b>Location Errors</b>: Default to known coordinates</li>
          </ul>
          <hr />
          <h1>
            <a class="anchor" id="autotoc_md47"></a> Performance Considerations
          </h1>
          <h2>
            <a class="anchor" id="autotoc_md48"></a> Real-time Requirements
          </h2>
          <ul>
            <li><b>CAN Sampling</b>: 10Hz (100ms intervals)</li>
            <li><b>UI Updates</b>: 60 FPS smooth animations</li>
            <li><b>Filter Latency</b>: &lt;100ms signal delay</li>
            <li><b>Memory Usage</b>: Optimized for embedded systems</li>
          </ul>
          <h2><a class="anchor" id="autotoc_md49"></a> Threading Model</h2>
          <ul>
            <li><b>Main Thread</b>: UI rendering and QML execution</li>
            <li><b>CAN Thread</b>: Asynchronous socket reading</li>
            <li><b>Timer-based</b>: Weather updates and data sampling</li>
          </ul>
          <h2><a class="anchor" id="autotoc_md50"></a> Resource Management</h2>
          <ul>
            <li><b>Socket Cleanup</b>: Proper CAN socket closure</li>
            <li><b>Memory Leaks</b>: Qt parent-child ownership model</li>
            <li><b>CPU Usage</b>: Efficient filter algorithms</li>
          </ul>
        </div>
      </div>
      <!-- contents -->
    </div>
    <!-- PageDoc -->
    <!-- start footer part -->
    <hr class="footer" />
    <address class="footer">
      <small>
        Generated by&#160;<a href="https://www.doxygen.org/index.html"
          ><img
            class="footer"
            src="doxygen.svg"
            width="104"
            height="31"
            alt="doxygen"
        /></a>
        1.9.8
      </small>
    </address>
  </body>
</html>
